!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.Failure=f()}}(function(){var define;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){function CallSite(frame){this.frame=frame}CallSite.prototype=Object.create({getLineNumber:function(){return this.frame.lineNumber},getColumnNumber:function(){return this.frame.columnNumber},getFileName:function(){return this.frame.fileName},getFunction:function(){return this.frame["function"]},getThis:function(){return null},getTypeName:function(){return null},getMethodName:function(){return this.frame.functionName?this.frame.functionName.split(".").pop():null},getFunctionName:function(){return this.frame.functionName},getEvalOrigin:function(){return null},isToplevel:function(){return!1},isEval:function(){return!1},isNative:function(){return!1},isConstructor:function(){return/^new(\s|$)/.test(this.frame.functionName)},toString:function(){var name=this.getFunctionName()||"<anonymous>",loc=this.getFileName()+":"+this.getLineNumber()+":"+this.getColumnNumber();return name+" ("+loc+")"}}),module.exports=CallSite},{}],2:[function(require,module,exports){(function(process,global){function Failure(message,sff){return this instanceof Failure?(this.sff=sff||this.constructor,this.message=message,this._getFrames=makeFramesGetter(this.sff),/\[native code\]/.test(Object.defineProperty)||(this.frames=unwind(this._getFrames()),this._getFrames=null,this.stack=this.generateStackTrace()),this):new Failure(message,sff||Failure)}function trim(frames,sff){var fn,name=sff.name;if(!frames)return console.warn("[Failure] error capturing frames"),[];for(var i=0;i<frames.length;i++)if(fn=frames[i].getFunction(),fn&&fn===sff||name&&name===frames[i].getFunctionName())return frames.slice(i+1);return frames}function unwind(frames){for(var fn,result=[],i=0;i<frames.length;i++)if(fn=frames[i].getFunction(),fn&&fn[SYMBOL_IGNORE]||result.push(frames[i]),fn&&fn[SYMBOL_FRAMES]){if(Failure.FRAME_EMPTY&&result.push(null),"function"==typeof fn[SYMBOL_FRAMES]){var getter=fn[SYMBOL_FRAMES];fn[SYMBOL_FRAMES]=null,fn[SYMBOL_FRAMES]=getter()}if(!fn[SYMBOL_FRAMES]){console.warn("[Failure] Empty frames annotation");continue}result.push.apply(result,unwind(fn[SYMBOL_FRAMES]));break}return result}function makeFramesGetterV8(sff){NativeError.captureStackTrace(V8FRAMES,sff||makeFramesGetterV8),sff=null;var frames=V8FRAMES.stack;return V8FRAMES.stack=null,V8FRAMES={},function(cleanup){var result=frames;return frames=null,result}}function makeFramesGetterCompat(sff){for(var error=getErrorWithStack(),caller=arguments.callee,functions=[getErrorWithStack],i=0;caller&&10>i&&(functions.push(caller),caller.caller!==caller);i++)caller=caller.caller;return caller=null,function(cleanup){var frames=null;if(!cleanup){frames=ErrorStackParser.parse(error);for(var i=2;i<frames.length;i++)frames[i]["function"]=functions[i],frames[i]=new CallSite(frames[i]);frames=trim(frames.slice(2),sff)}return sff=error=functions=null,frames}}function exclude(ctor,predicate){var fn=predicate;"string"==typeof predicate?fn=function(frame){return-1!==frame.getFileName().indexOf(predicate)}:"function"==typeof predicate.test&&(fn=function(frame){return predicate.test(frame.getFileName())}),ctor.excludes.push(fn)}var ErrorStackParser=require("error-stack-parser"),CallSite=require("./call-site"),NativeError=Error,SYMBOL_FRAMES="@@failure/frames",SYMBOL_IGNORE="@@failure/ignore";Failure.FRAME_EMPTY="  ----",Failure.FRAME_PREFIX="  at ",Failure.TRACKING=!0;var getErrorWithStack=function(){return new NativeError};getErrorWithStack().stack||(getErrorWithStack=function(){try{throw new NativeError}catch(e){return e}});var V8FRAMES={},makeFramesGetter="function"==typeof NativeError.captureStackTrace?makeFramesGetterV8:makeFramesGetterCompat,oldPrepareStackTrace=Error.prepareStackTrace;Error.prepareStackTrace=function(error,frames){if(error===V8FRAMES)return frames;if(oldPrepareStackTrace)try{return oldPrepareStackTrace.call(Error,error,frames)}catch(e){}return Failure.prototype.prepareStackTrace.call(error,unwind(frames))},Failure.excludes=[],Failure.exclude=exclude.bind(null,Failure),Failure.track=function Failure_track(fn,sff){return"function"!=typeof fn?fn:("function"==typeof fn[SYMBOL_FRAMES]&&fn[SYMBOL_FRAMES](!0),Failure.TRACKING&&(fn[SYMBOL_FRAMES]=null,fn[SYMBOL_FRAMES]=makeFramesGetter(sff||Failure_track)),fn)},Failure.wrap=function Failure_wrap(fn){var wrapper=Failure.ignore(function(){return fn.apply(this,arguments)});return Failure.track(wrapper,Failure_wrap)},Failure.ignore=function(fn){return fn[SYMBOL_IGNORE]=!0,fn},Failure.setTimeout=function Failure_setTimeout(){return arguments[0]=Failure.track(arguments[0],Failure_setTimeout),setTimeout.apply(null,arguments)},Failure.nextTick=function Failure_nextTick(){return arguments[0]=Failure.track(arguments[0],Failure_nextTick),process.nextTick.apply(process,arguments)},Failure.patch=function(obj,name,idx){if(obj&&"function"!=typeof obj[name])throw new Error('Object does not have a "'+name+'" method');var original=obj[name];"number"==typeof idx?obj[name]=function(){return arguments[idx]=Failure.track(arguments[idx],obj[name]),original.apply(this,arguments)}:obj[name]=function(){for(var i=0;i<arguments.length;i++)"function"==typeof arguments[i]&&(arguments[i]=Failure.track(arguments[i],obj[name]));return original.apply(this,arguments)};for(var k in original)original.hasOwnProperty(k)&&(obj[name][k]=original[k]);return obj[name]},Failure.create=function(name,props){function ctor(message,sff){return this instanceof Failure?void Failure.apply(this,arguments):new ctor(message,sff)}if("string"!=typeof name)throw new Failure("Expected a name as first argument");return ctor.excludes=[],ctor.exclude=function(predicate){exclude(ctor,predicate)},ctor.prototype=Object.create(Failure.prototype),ctor.prototype.constructor=ctor,ctor.prototype.name=name,"function"==typeof props?ctor.prototype.prepareStackTrace=props:props&&Object.keys(props).forEach(function(prop){ctor.prototype[prop]=prop}),ctor};var builtinErrorTypes=["Error","TypeError","RangeError","ReferenceError","SyntaxError","EvalError","URIError","InternalError"],builtinErrors={};Failure.install=function(){var root="object"==typeof window?window:global;return builtinErrorTypes.forEach(function(type){root[type]&&!builtinErrors[type]&&(builtinErrors[type]=root[type],root[type]=Failure.create(type))}),Failure},Failure.uninstall=function(){builtinErrorTypes.forEach(function(type){root[type]=builtinErrors[type]||root[type]})};var proto=Failure.prototype=Object.create(Error.prototype);proto.constructor=Failure,proto.name="Failure",proto.message="","function"==typeof Object.defineProperty&&(Object.defineProperty(proto,"frames",{get:function(){var frames=unwind(trim(this._getFrames(),this.sff));return Object.defineProperty(this,"frames",{value:frames,writable:!0}),this._getFrames=null,frames}}),Object.defineProperty(proto,"stack",{get:function(){var stack=this.generateStackTrace();return Object.defineProperty(this,"stack",{value:stack,writable:!0}),stack}})),proto.generateStackTrace=function(){var include,excludes=this.constructor.excludes,frames=[];excludes!==Failure.excludes&&excludes.push.apply(excludes,Failure.excludes);for(var i=0;i<this.frames.length;i++){if(include=!0,this.frames[i])for(var j=0;include&&j<excludes.length;j++)include&=!excludes[j].call(this,this.frames[i]);include&&frames.push(this.frames[i])}return oldPrepareStackTrace?(frames=frames.filter(function(x){return!!x}),oldPrepareStackTrace.call(Error,this,frames)):this.prepareStackTrace(frames)},proto.prepareStackTrace=function(frames){for(var lines=[this],i=0;i<frames.length;i++)lines.push(frames[i]?Failure.FRAME_PREFIX+frames[i]:Failure.FRAME_EMPTY);return lines.join("\n")},module.exports=Failure}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./call-site":1,_process:4,"error-stack-parser":5}],3:[function(require,module,exports){var Failure=require("./lib/failure");module.exports=Failure},{"./lib/failure":2}],4:[function(require,module,exports){function cleanUpNextTick(){draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue()}function drainQueue(){if(!draining){var timeout=setTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,clearTimeout(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}var currentQueue,process=module.exports={},queue=[],draining=!1,queueIndex=-1;process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||setTimeout(drainQueue,0)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],5:[function(require,module,exports){!function(root,factory){"use strict";"function"==typeof define&&define.amd?define("error-stack-parser",["stackframe"],factory):"object"==typeof exports?module.exports=factory(require("stackframe")):root.ErrorStackParser=factory(root.StackFrame)}(this,function(StackFrame){"use strict";var FIREFOX_SAFARI_STACK_REGEXP=/(^|@)\S+\:\d+/,CHROME_IE_STACK_REGEXP=/\s+at .*(\S+\:\d+|\(native\))/;return{parse:function(error){if("undefined"!=typeof error.stacktrace||"undefined"!=typeof error["opera#sourceloc"])return this.parseOpera(error);if(error.stack&&error.stack.match(CHROME_IE_STACK_REGEXP))return this.parseV8OrIE(error);if(error.stack&&error.stack.match(FIREFOX_SAFARI_STACK_REGEXP))return this.parseFFOrSafari(error);throw new Error("Cannot parse given Error object")},extractLocation:function(urlLike){if(-1===urlLike.indexOf(":"))return[urlLike];var locationParts=urlLike.replace(/[\(\)\s]/g,"").split(":"),lastNumber=locationParts.pop(),possibleNumber=locationParts[locationParts.length-1];if(!isNaN(parseFloat(possibleNumber))&&isFinite(possibleNumber)){var lineNumber=locationParts.pop();return[locationParts.join(":"),lineNumber,lastNumber]}return[locationParts.join(":"),lastNumber,void 0]},parseV8OrIE:function(error){return error.stack.split("\n").filter(function(line){return!!line.match(CHROME_IE_STACK_REGEXP)},this).map(function(line){var tokens=line.replace(/^\s+/,"").split(/\s+/).slice(1),locationParts=this.extractLocation(tokens.pop()),functionName=tokens[0]&&"Anonymous"!==tokens[0]?tokens[0]:void 0;return new StackFrame(functionName,void 0,locationParts[0],locationParts[1],locationParts[2],line)},this)},parseFFOrSafari:function(error){return error.stack.split("\n").filter(function(line){return!!line.match(FIREFOX_SAFARI_STACK_REGEXP)},this).map(function(line){var tokens=line.split("@"),locationParts=this.extractLocation(tokens.pop()),functionName=tokens.shift()||void 0;return new StackFrame(functionName,void 0,locationParts[0],locationParts[1],locationParts[2],line)},this)},parseOpera:function(e){return!e.stacktrace||e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?this.parseOpera9(e):e.stack?this.parseOpera11(e):this.parseOpera10(e)},parseOpera9:function(e){for(var lineRE=/Line (\d+).*script (?:in )?(\S+)/i,lines=e.message.split("\n"),result=[],i=2,len=lines.length;len>i;i+=2){var match=lineRE.exec(lines[i]);match&&result.push(new StackFrame(void 0,void 0,match[2],match[1],void 0,lines[i]))}return result},parseOpera10:function(e){for(var lineRE=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,lines=e.stacktrace.split("\n"),result=[],i=0,len=lines.length;len>i;i+=2){var match=lineRE.exec(lines[i]);match&&result.push(new StackFrame(match[3]||void 0,void 0,match[2],match[1],void 0,lines[i]))}return result},parseOpera11:function(error){return error.stack.split("\n").filter(function(line){return!!line.match(FIREFOX_SAFARI_STACK_REGEXP)&&!line.match(/^Error created at/)},this).map(function(line){var argsRaw,tokens=line.split("@"),locationParts=this.extractLocation(tokens.pop()),functionCall=tokens.shift()||"",functionName=functionCall.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^\)]*\)/g,"")||void 0;functionCall.match(/\(([^\)]*)\)/)&&(argsRaw=functionCall.replace(/^[^\(]+\(([^\)]*)\)$/,"$1"));var args=void 0===argsRaw||"[arguments not available]"===argsRaw?void 0:argsRaw.split(",");return new StackFrame(functionName,args,locationParts[0],locationParts[1],locationParts[2],line)},this)}}})},{stackframe:6}],6:[function(require,module,exports){!function(root,factory){"use strict";"function"==typeof define&&define.amd?define("stackframe",[],factory):"object"==typeof exports?module.exports=factory():root.StackFrame=factory()}(this,function(){"use strict";function _isNumber(n){return!isNaN(parseFloat(n))&&isFinite(n)}function StackFrame(functionName,args,fileName,lineNumber,columnNumber,source){void 0!==functionName&&this.setFunctionName(functionName),void 0!==args&&this.setArgs(args),void 0!==fileName&&this.setFileName(fileName),void 0!==lineNumber&&this.setLineNumber(lineNumber),void 0!==columnNumber&&this.setColumnNumber(columnNumber),void 0!==source&&this.setSource(source)}return StackFrame.prototype={getFunctionName:function(){return this.functionName},setFunctionName:function(v){this.functionName=String(v)},getArgs:function(){return this.args},setArgs:function(v){if("[object Array]"!==Object.prototype.toString.call(v))throw new TypeError("Args must be an Array");this.args=v},getFileName:function(){return this.fileName},setFileName:function(v){this.fileName=String(v)},getLineNumber:function(){return this.lineNumber},setLineNumber:function(v){if(!_isNumber(v))throw new TypeError("Line Number must be a Number");this.lineNumber=Number(v)},getColumnNumber:function(){return this.columnNumber},setColumnNumber:function(v){if(!_isNumber(v))throw new TypeError("Column Number must be a Number");this.columnNumber=Number(v)},getSource:function(){return this.source},setSource:function(v){this.source=String(v)},toString:function(){var functionName=this.getFunctionName()||"{anonymous}",args="("+(this.getArgs()||[]).join(",")+")",fileName=this.getFileName()?"@"+this.getFileName():"",lineNumber=_isNumber(this.getLineNumber())?":"+this.getLineNumber():"",columnNumber=_isNumber(this.getColumnNumber())?":"+this.getColumnNumber():"";return functionName+args+fileName+lineNumber+columnNumber}},StackFrame})},{}]},{},[3])(3)});